# Overview  
This project delivers a minimal, fully MCP-compliant server and client setup for exploring and validating session-based tool invocation workflows using the [Model Context Protocol (MCP)](https://modelcontext.org). It is specifically designed for developers working with OpenAI‚Äôs Agents SDK or other MCP clients who need a clear, grounded understanding of what MCP actually sends and expects over the wire.

The server and client are implemented in TypeScript using the official [`@modelcontextprotocol/sdk`](https://github.com/modelcontextprotocol/typescript-sdk). This combo enables precise inspection and debugging of MCP semantics including JSON-RPC payloads, HTTP headers (e.g., `Mcp-Session-Id`), and Server-Sent Events (SSE) behavior.

# Core Features  

## ‚úÖ Toy Stateful MCP Server
- **What it does:** Implements a minimal MCP server in Express.js with stateful session handling and a couple of test tools: `imagine` (generates and stores random data) and `reveal` (returns data generated by `imagine` in the same session).
- **Why it's important:** Demonstrates how to properly implement session state and tool logic using MCP's required conventions and headers.
- **How it works:** Uses the TypeScript SDK‚Äôs `McpServer` and `StreamableHTTPServerTransport` with an in-memory session map keyed by `mcp-session-id`.

## ‚úÖ Fully Compliant Integration Test Client
- **What it does:** Uses the official MCP client SDK to run test scenarios against the toy server, validating that sessions persist and responses are streamed correctly via SSE.
- **Why it's important:** Ensures the server behaves according to MCP spec, and gives developers a reproducible testing harness.
- **How it works:** The client issues `initialize`, `tools/list`, and `tools/call` JSON-RPC requests to `/mcp`, tracking and reusing session IDs, and validates streamed results from `/mcp` via `EventSource`.

## ‚úÖ Wire Protocol Inspector
- **What it does:** Logs all inbound/outbound JSON-RPC requests, HTTP headers, and SSE messages.
- **Why it's important:** Enables deep debugging and clarity about what the actual wire protocol is doing.
- **How it works:** Middleware or logger wrappers capture request/response state at the HTTP and JSON-RPC layers.

# User Experience  

## User Personas
- **MCP implementers** trying to understand the protocol‚Äôs behavior before committing to backend or agent logic.
- **LLM agent developers** evaluating or troubleshooting tool server integration with OpenAI's Agents SDK.
- **Infra/devops** engineers debugging session lifecycles and stream persistence behavior.

## Key User Flows
- Run the server locally, observe that `/mcp` responds to JSON-RPC and SSE requests.
- Start the test client and verify that `imagine` generates a value and `reveal` returns it only when using the same session.
- Modify or extend the test tools and observe corresponding changes in JSON-RPC request/response behavior.

## UI/UX Considerations
- CLI-based development workflow (Node/TS project).
- Logs and protocol events printed to console with optional verbose/debug flags.
- All state is ephemeral and observable (no persistent DB needed).

# Technical Architecture  

## System Components
- **Express.js server** using `@modelcontextprotocol/sdk` for MCP compliance
- **In-memory session store** keyed by `mcp-session-id`
- **McpServer** instance per session, with two dummy tools (`imagine`, `reveal`)
- **SSE support** via `StreamableHTTPServerTransport` for streamed JSON-RPC responses
- **MCP Client** running scripted tests using `@modelcontextprotocol/sdk/client`

## Data Models
- Session ID ‚Üí { MCP Server Instance, Generated Data }
- JSON-RPC request/response payloads conforming to MCP spec

## APIs and Integrations
- `POST /mcp` ‚Äì Accepts all JSON-RPC calls (e.g. `tools/call`, `tools/list`, `initialize`)
- `GET /mcp` ‚Äì Streams responses as SSE
- `DELETE /mcp` ‚Äì Terminates session
- Integration test client communicates exclusively via these routes using the SDK

## Infrastructure Requirements
- Node.js 18+
- No database or external services
- Compatible with local dev environments and containerized testing if desired

# Development Roadmap  

## Phase 1: MVP
- Scaffold Express.js server with MCP SDK
- Implement session storage using in-memory Map
- Register `imagine` and `reveal` tools
- Hook up transport via `StreamableHTTPServerTransport`
- Implement logging middleware for session tracking and RPC inspection
- Build integration test client using SDK's `Client` class
- Validate full session flow: initialize ‚Üí imagine ‚Üí reveal

## Phase 2: Observability & Debugging
- Add protocol inspection (raw logs, JSON-RPC dump, header trace)
- Add test harness for breaking sessions (e.g., invalid session ID, deleted session)
- Implement SSE heartbeats and timeouts

## Phase 3: Extensibility Playground
- Add ability to dynamically register new tools during session
- Swap in a file-based or Redis-backed session store (optional)
- Prepare Dockerfile for containerized deployment/testing

# Logical Dependency Chain  

1. ‚úÖ Foundation: MCP server shell using SDK and Express
2. ‚úÖ Transport plumbing: wire up `/mcp` POST/GET/DELETE, manage `mcp-session-id`
3. ‚úÖ Tool wiring: register `imagine`/`reveal` and verify session sharing
4. ‚úÖ Integration test client to drive and validate behavior
5. üîç Observability: loggers, trace tools, SSE debug output
6. üß™ Resilience: test invalid sessions, expired sessions, malformed inputs
7. üß± Advanced: external state store, multi-tool registration, Dockerization

# Risks and Mitigations  

## Risk: Protocol drift or unclear behavior
- **Mitigation:** Base all functionality strictly on SDK behavior and observed wire logs from SDK client-server traffic.

## Risk: SSE edge-case complexity
- **Mitigation:** Test SSE separately with curl/mitmproxy and ensure timeout/flush behavior is observable and configurable.

## Risk: Over-engineering too early
- **Mitigation:** Keep first version in-memory only, no Redis or DB until needed. Ensure MVP is fully understood and documented.

# Appendix  

## Research Findings
- MCP uses JSON-RPC over HTTP, multiplexed through `/mcp`
- Session state is tracked exclusively via `Mcp-Session-Id` headers
- SDK provides full transport, dispatch, and SSE support via `StreamableHTTPServerTransport`
- Only one HTTP endpoint (`/mcp`) is expected to serve all traffic

## Technical Specifications
- Node.js, TypeScript
- `@modelcontextprotocol/sdk` latest version
- Optional tools: mitmproxy, curl, Chrome DevTools to debug SSE

